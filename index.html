<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√≤ng Quay May M·∫Øn - SeaZen Fashion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* --- C·∫¨P NH·∫¨T: ƒê·ªïi n·ªÅn gradient th√†nh m·ªôt m√†u t·ªëi duy nh·∫•t --- */
            --primary-bg: #1a1a2e; 
            --secondary-bg: rgba(255, 255, 255, 0.08);
            --card-bg: rgba(255, 255, 255, 0.12);
            --accent-gold: #D4AF37;
            --accent-silver: #C0C0C0;
            --accent-bronze: #CD7F32;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.85);
            --shadow-1: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-2: 0 16px 64px rgba(0, 0, 0, 0.4);
            --border-radius: 24px;
            --glass-border: 1px solid rgba(255, 255, 255, 0.18);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-bg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 16px;
            position: relative;
            overflow-x: hidden;
            /* --- C·∫¨P NH·∫¨T: X√≥a background-attachment ƒë·ªÉ t∆∞∆°ng th√≠ch mobile t·ªët h∆°n --- */
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(212, 175, 55, 0.6);
            border-radius: 50%;
            animation: float 25s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.4); }
            50% { box-shadow: 0 0 40px rgba(212, 175, 55, 0.8), 0 0 60px rgba(212, 175, 55, 0.6); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* Header Section */
        .header {
            text-align: center;
            margin-bottom: 24px;
            backdrop-filter: blur(20px);
            background: var(--card-bg);
            padding: 20px 16px;
            border-radius: var(--border-radius);
            border: var(--glass-border);
            box-shadow: var(--shadow-1);
            width: 100%;
            max-width: 400px;
        }
        
        .header h1 {
            /* --- C·∫¨P NH·∫¨T: Gi·∫£m k√≠ch th∆∞·ªõc font ƒë·ªÉ kh√¥ng b·ªã xu·ªëng d√≤ng --- */
            font-size:  1.5rem; 
            font-weight: 800;
            color: #FFD700;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7), 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .header .subtitle {
            font-size: 1rem;
            font-weight: 600;
            color: #E0E0E0;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 12px;
            text-shadow: 0 0 8px rgba(224, 224, 224, 0.6);
        }

        .header-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        #view-last-code-btn {
            background: linear-gradient(45deg, var(--accent-bronze), var(--accent-gold));
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: var(--shadow-1);
            min-height: 36px;
        }

        #view-last-code-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-2);
        }

        /* Wheel Container */
        main {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .wheel-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
        }

        .wheel-container {
            position: relative;
            width: min(85vw, 350px);
            height: min(85vw, 350px);
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(20px);
            background: var(--card-bg);
            border-radius: 50%;
            border: var(--glass-border);
            box-shadow: var(--shadow-2);
            animation: pulse 6s ease-in-out infinite;
        }

        #wheel-canvas {
            width: 90%;
            height: 90%;
            border-radius: 50%;
            transition: transform 4s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.3);
        }

        .pointer {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 16px solid transparent;
            border-right: 16px solid transparent;
            border-bottom: 32px solid var(--accent-gold);
            z-index: 10;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
            animation: glow 2s ease-in-out infinite;
        }

        #spin-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--accent-gold);
            background: linear-gradient(45deg, var(--accent-gold), #F4E4BC);
            color: #1a1a2e;
            font-size: 0.9rem;
            font-weight: 700;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            z-index: 20;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-1);
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.2;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        #spin-btn:hover:not(:disabled) {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: var(--shadow-2);
        }

        #spin-btn:disabled {
            cursor: not-allowed;
            background: linear-gradient(45deg, #666, #888);
            color: #ccc;
            font-size: 0.7rem;
            font-weight: 500;
            border-color: #666;
        }

        .prize-list-section {
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
            backdrop-filter: blur(20px);
            background: var(--card-bg);
            padding: 20px 16px;
            border-radius: var(--border-radius);
            border: var(--glass-border);
            box-shadow: var(--shadow-1);
        }

        .prize-list-section h2 {
            font-size: 1rem;
            font-weight: 500;
            color: var(--accent-gold);
            text-align: center;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer; 
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .prize-list-section h2 .toggle-icon {
            transition: transform 0.4s ease;
            display: inline-block; 
            line-height: 0;
        }
        
        .prize-list-section h2.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .prize-table-wrapper {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }

        .prize-table-wrapper.expanded {
            max-height: 350px;
        }

        .prize-table {
            width: 100%;
            border-collapse: collapse;
        }

        .prize-table td {
            padding: 10px 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prize-table tr:last-child td {
            border-bottom: none;
        }


        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            padding: 16px;
            pointer-events: none;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
            backdrop-filter: blur(30px);
            padding: 24px 20px;
            border-radius: var(--border-radius);
            border: var(--glass-border);
            box-shadow: var(--shadow-2);
            text-align: center;
            width: 100%;
            max-width: 320px;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-content h2 {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--accent-gold);
            margin-bottom: 16px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .modal-content .prize-announcement,
        .modal-content .promo-code-label {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        #prize-result {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            padding: 16px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 12px;
            border: 2px solid var(--accent-gold);
        }

        #prize-condition {
            font-size: 0.85rem;
            color: var(--accent-silver);
            font-style: italic;
            margin: 12px 0;
            line-height: 1.4;
        }

        #promo-code {
            display: inline-block;
            background: linear-gradient(45deg, var(--accent-gold), #F4E4BC);
            color: #1a1a2e;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 800;
            letter-spacing: 2px;
            margin-top: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-1);
        }

        .modal-close-btn {
            margin-top: 20px;
            padding: 12px 32px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, var(--accent-bronze), var(--accent-gold));
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: var(--shadow-1);
        }

        .modal-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-2);
        }

        /* Password Modal */
        .password-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
            backdrop-filter: blur(30px);
            padding: 24px 20px;
            border-radius: var(--border-radius);
            border: var(--glass-border);
            box-shadow: var(--shadow-2);
            text-align: center;
            width: 100%;
            max-width: 300px;
        }

        .password-content h3 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 16px;
        }

        .password-content p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.4;
        }

        #password-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--accent-gold);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            text-align: center;
            margin-bottom: 16px;
            backdrop-filter: blur(10px);
        }

        #password-input:focus {
            outline: none;
            border-color: var(--accent-silver);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        #password-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .password-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        #password-submit, #password-cancel {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #password-submit {
            background: linear-gradient(45deg, var(--accent-bronze), var(--accent-gold));
            color: white;
        }

        #password-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Floating Action Button (FAB) for Extra Spin */
        .fab-add-spin {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, var(--accent-bronze), var(--accent-gold));
            border-radius: 50%;
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: var(--shadow-2);
            cursor: pointer;
            z-index: 999;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            color: white;
        }

        .fab-add-spin:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5);
        }

        .fab-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background-color: #e74c3c;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            font-weight: 700;
            border: 2px solid var(--primary-bg);
        }
        
        .hidden { display: none !important; }

        /* Responsive adjustments */
        @media (max-width: 360px) {
            .header { padding: 16px 12px; }
            .wheel-container {
                width: min(80vw, 300px);
                height: min(80vw, 300px);
            }
            #spin-btn { width: 70px; height: 70px; font-size: 0.8rem; }
            .fab-add-spin { width: 50px; height: 50px; bottom: 16px; right: 16px; }
        }

        @media (max-height: 600px) and (orientation: landscape) {
            body { padding: 8px; }
            .header { margin-bottom: 16px; padding: 12px; }
            .header h1 { font-size: 1.5rem; }
            .wheel-container {
                width: min(50vh, 280px);
                height: min(50vh, 280px);
            }
        }
    </style>
</head>
<body>
    <div class="particles"></div>

    <div class="header">
        <h1>V√íNG QUAY MAY M·∫ÆN</h1>
        <div class="subtitle">SeaZen Fashion</div>
        <div class="header-buttons">
            <button id="view-last-code-btn" class="hidden">Xem l·∫°i m√£</button>
        </div>
    </div>
    
    <main>
        <div class="wheel-section">
            <div class="wheel-container">
                <canvas id="wheel-canvas"></canvas>
                <button id="spin-btn">QUAY</button>
            </div>
        </div>

        <div class="prize-list-section">
            <h2 id="prize-list-toggle">
                Danh s√°ch gi·∫£i th∆∞·ªüng
                <span class="toggle-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#D4AF37" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-9"/></svg>
                </span>
            </h2>
            <div id="prize-table-wrapper" class="prize-table-wrapper">
                <table class="prize-table">
                    <tbody>
                        <tr><td>V√≠ da cao c·∫•p - S·ªë l∆∞·ª£ng: 5</td></tr>
                        <tr><td>Th·∫Øt l∆∞ng da cao c·∫•p - S·ªë l∆∞·ª£ng: 5</td></tr>
                        <tr><td>Gi√†y loafer nam - S·ªë l∆∞·ª£ng: 2</td></tr>
                        <tr><td>Voucher mua h√†ng gi·∫£m 70% - S·ªë l∆∞·ª£ng: 1</td></tr>
                        <tr><td>Voucher mua h√†ng gi·∫£m 20% - S·ªë l∆∞·ª£ng: 4</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <div id="result-modal" class="modal-overlay" role="dialog" aria-modal="true">
        <div class="modal-content">
            <h2>CH√öC M·ª™NG! üéâ</h2>
            <div class="prize-announcement">B·∫°n ƒë√£ tr√∫ng:</div>
            <div id="prize-result"></div>
            <div id="prize-condition"></div>
            <div class="promo-code-label">Vui l√≤ng ƒë∆∞a m√£ d∆∞·ªõi ƒë√¢y cho nh√¢n vi√™n ƒë·ªÉ ƒë∆∞·ª£c nh·∫≠n khuy·∫øn m√£i:</div>
            <div id="promo-code"></div>
            <button id="modal-close-btn" class="modal-close-btn">ƒê√≥ng</button>
        </div>
    </div>

    <div id="password-modal" class="modal-overlay" role="dialog" aria-modal="true">
        <div class="password-content">
            <h3>üîê M·∫≠t kh·∫©u ƒë·∫∑c bi·ªát</h3>
            <p>Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ nh·∫≠n th√™m 1 l∆∞·ª£t quay mi·ªÖn ph√≠!</p>
            <input type="password" id="password-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." maxlength="20">
            <div class="password-buttons">
                <button id="password-submit">X√°c nh·∫≠n</button>
                <button id="password-cancel">H·ªßy</button>
            </div>
        </div>
    </div>

    <button id="fab-add-spin-btn" class="fab-add-spin" aria-label="Th√™m l∆∞·ª£t quay">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="28" height="28">
            <path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2h6z"></path>
        </svg>
        <span id="extra-spins-badge" class="fab-badge hidden"></span>
    </button>


    <script>
        const app = {
            // --- CONFIGURATION ---
            config: {
                COOLDOWN_HOURS: 24,
                SECRET_PASSWORD: '12123131',
                WEBHOOK_URL: "https://hook.us2.make.com/kyk3fhqa8sdy6nxqx2q9dmsjeat432k2",
                localStorageKeys: {
                    LAST_SPIN: 'lastSpinTimestamp',
                    LAST_WIN: 'lastWinData',
                    EXTRA_SPINS: 'extraSpins'
                },
                prizes: [
                    { name: "V√≠ da cao c·∫•p", fullName: "V√≠ da cao c·∫•p", type: "wallet", probability: 0.30 },
                    { name: "Th·∫Øt l∆∞ng da cao c·∫•p", fullName: "Th·∫Øt l∆∞ng da cao c·∫•p", type: "belt", probability: 0.20 },
                    { name: "Gi√†y loafer nam", fullName: "Gi√†y loafer nam", type: "loafer", probability: 0.20 },
                    { name: "Voucher 70%", fullName: "Voucher mua h√†ng gi·∫£m 70%", type: "v70", probability: 0.10 },
                    { name: "Voucher 20%", fullName: "Voucher mua h√†ng gi·∫£m 20%", type: "v20", probability: 0.20 }
                ],
                colorMap: {
                    'wallet': '#8B4513',
                    'belt': '#4B0082',
                    'loafer': '#006400',
                    'v70': '#B8860B',
                    'v20': '#2F4F4F'
                }
            },

            // --- APPLICATION STATE ---
            state: {
                isSpinning: false,
                countdownInterval: null,
                currentRotation: 0,
                radius: 0
            },

            // --- DOM ELEMENTS ---
            elements: {
                canvas: document.getElementById('wheel-canvas'),
                spinBtn: document.getElementById('spin-btn'),
                wheelContainer: document.querySelector('.wheel-container'),
                resultModal: document.getElementById('result-modal'),
                prizeResultEl: document.getElementById('prize-result'),
                promoCodeEl: document.getElementById('promo-code'),
                prizeConditionEl: document.getElementById('prize-condition'),
                modalCloseBtn: document.getElementById('modal-close-btn'),
                viewLastCodeBtn: document.getElementById('view-last-code-btn'),
                fabAddSpinBtn: document.getElementById('fab-add-spin-btn'),
                extraSpinsBadge: document.getElementById('extra-spins-badge'),
                passwordModal: document.getElementById('password-modal'),
                passwordInput: document.getElementById('password-input'),
                passwordSubmit: document.getElementById('password-submit'),
                passwordCancel: document.getElementById('password-cancel'),
                particlesContainer: document.querySelector('.particles'),
                prizeListToggle: document.getElementById('prize-list-toggle'),
                prizeTableWrapper: document.getElementById('prize-table-wrapper'),
            },

            // --- INITIALIZATION ---
            init() {
                this.ctx = this.elements.canvas.getContext('2d');
                this.assignPrizeColors();
                this.createParticles();
                this.drawWheel();
                this.updateUIState();
                this.attachEventListeners();
            },

            // --- EVENT LISTENERS ---
            attachEventListeners() {
                window.addEventListener('resize', () => this.drawWheel());
                this.elements.spinBtn.addEventListener('click', () => this.spin());
                this.elements.viewLastCodeBtn.addEventListener('click', () => this.showLastWin());
                this.elements.fabAddSpinBtn.addEventListener('click', () => this.toggleModal(this.elements.passwordModal, true));
                this.elements.modalCloseBtn.addEventListener('click', () => this.toggleModal(this.elements.resultModal, false));
                this.elements.passwordSubmit.addEventListener('click', () => this.checkPassword());
                this.elements.passwordCancel.addEventListener('click', () => this.toggleModal(this.elements.passwordModal, false));

                this.elements.prizeListToggle.addEventListener('click', () => this.togglePrizeList());

                this.elements.passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.checkPassword();
                });

                this.elements.resultModal.addEventListener('click', (e) => {
                    if (e.target === this.elements.resultModal) this.toggleModal(this.elements.resultModal, false);
                });
                this.elements.passwordModal.addEventListener('click', (e) => {
                    if (e.target === this.elements.passwordModal) this.toggleModal(this.elements.passwordModal, false);
                });
            },
            
            togglePrizeList() {
                this.elements.prizeTableWrapper.classList.toggle('expanded');
                this.elements.prizeListToggle.classList.toggle('expanded');
            },

            // --- WHEEL DRAWING ---
            assignPrizeColors() {
                this.config.prizes.forEach(prize => {
                    prize.color = this.config.colorMap[prize.type] || '#483D8B';
                });
            },

            drawWheel() {
                const { canvas, wheelContainer } = this.elements;
                const size = Math.min(wheelContainer.clientWidth * 0.9, wheelContainer.clientHeight * 0.9);
                canvas.width = size;
                canvas.height = size;
                this.state.radius = size / 2;

                this.ctx.clearRect(0, 0, size, size);
                this.ctx.save();
                this.ctx.translate(this.state.radius, this.state.radius);

                const anglePerPrize = (2 * Math.PI) / this.config.prizes.length;

                this.config.prizes.forEach((prize, i) => {
                    const startAngle = i * anglePerPrize;
                    const gradient = this.ctx.createRadialGradient(0, 0, 0, 0, 0, this.state.radius);
                    gradient.addColorStop(0, this.utils.adjustColor(prize.color, 40));
                    gradient.addColorStop(0.7, prize.color);
                    gradient.addColorStop(1, this.utils.adjustColor(prize.color, -20));

                    this.ctx.beginPath();
                    this.ctx.moveTo(0, 0);
                    this.ctx.arc(0, 0, this.state.radius - 5, startAngle, startAngle + anglePerPrize);
                    this.ctx.closePath();
                    this.ctx.fillStyle = gradient;
                    this.ctx.fill();

                    this.ctx.strokeStyle = 'rgba(212, 175, 55, 0.6)';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();

                    this.ctx.save();
                    this.ctx.rotate(startAngle + anglePerPrize / 2);
                    this.ctx.textAlign = 'right';
                    this.ctx.fillStyle = '#ffffff';
                    this.ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                    this.ctx.shadowBlur = 4;
                    this.ctx.font = `bold ${Math.max(10, Math.floor(this.state.radius * 0.055))}px Inter`;
                    
                    const words = prize.name.split(' ');
                    const textRadius = this.state.radius * 0.75;
                    if (words.length > 2) {
                        const mid = Math.ceil(words.length / 2);
                        this.ctx.fillText(words.slice(0, mid).join(' '), textRadius, -5);
                        this.ctx.fillText(words.slice(mid).join(' '), textRadius, 12);
                    } else {
                        this.ctx.fillText(prize.name, textRadius, 5);
                    }
                    this.ctx.restore();
                });
                this.ctx.restore();
            },
            
            // --- SPIN LOGIC ---
            getWinnerIndex() {
                const random = Math.random();
                let cumulative = 0;
                for (let i = 0; i < this.config.prizes.length; i++) {
                    cumulative += this.config.prizes[i].probability;
                    if (random < cumulative) return i;
                }
                return this.config.prizes.length - 1; 
            },

            spin() {
                if (this.state.isSpinning || !this.canSpin()) return;

                this.state.isSpinning = true;
                this.elements.spinBtn.disabled = true;
                this.elements.spinBtn.textContent = "ƒêANG QUAY...";

                const winnerIndex = this.getWinnerIndex();
                const anglePerPrize = 360 / this.config.prizes.length;
                const targetAngle = winnerIndex * anglePerPrize;
                const randomOffset = (Math.random() - 0.5) * anglePerPrize * 0.8;
                const totalRotation = this.state.currentRotation + (5 * 360) + (360 - targetAngle) - randomOffset;
                
                this.elements.canvas.style.transform = `rotate(${totalRotation}deg)`;
                this.state.currentRotation = totalRotation % 360;

                setTimeout(() => {
                    const winningPrize = this.config.prizes[winnerIndex];
                    const promoCode = this.utils.generatePromoCode();
                    
                    this.handleSpinCompletion(winningPrize, promoCode);
                }, 4100);
            },

            handleSpinCompletion(prize, code) {
                const { userId, phone, displayName, name } = this.utils.getUrlParams();
                const payload = {
                    userId,
                    phone,
                    displayName,
                    name,
                    prizeName: prize.fullName,
                    prizeType: prize.type,
                    promoCode: code, spinTimestamp: new Date().toISOString()
                };
                this.utils.sendDataToWebhook(payload);
                this.showResultModal(prize, code);

                const extraSpins = this.utils.getExtraSpins();
                if (extraSpins > 0) {
                    this.utils.setExtraSpins(extraSpins - 1);
                } else {
                    localStorage.setItem(this.config.localStorageKeys.LAST_SPIN, Date.now());
                }
                
                localStorage.setItem(this.config.localStorageKeys.LAST_WIN, JSON.stringify({
                    prizeName: prize.fullName, 
                    promoCode: code, 
                    prizeType: prize.type
                }));

                this.state.isSpinning = false;
                this.updateUIState();
            },

            // --- UI AND STATE MANAGEMENT ---
            updateUIState() {
                const extraSpins = this.utils.getExtraSpins();

                if (extraSpins > 0) {
                    this.elements.extraSpinsBadge.textContent = extraSpins;
                    this.elements.extraSpinsBadge.classList.remove('hidden');
                } else {
                    this.elements.extraSpinsBadge.classList.add('hidden');
                }

                if (this.canSpin()) {
                    if (this.state.countdownInterval) clearInterval(this.state.countdownInterval);
                    this.elements.spinBtn.disabled = this.state.isSpinning;
                    this.elements.spinBtn.innerHTML = this.state.isSpinning ? "ƒêANG QUAY..." : "QUAY";
                    this.elements.spinBtn.style.fontSize = "0.9rem";
                    
                    if (localStorage.getItem(this.config.localStorageKeys.LAST_WIN)) {
                        this.elements.viewLastCodeBtn.classList.remove("hidden");
                    } else {
                        this.elements.viewLastCodeBtn.classList.add("hidden");
                    }
                    return;
                }
                
                this.elements.spinBtn.disabled = true;
                this.elements.viewLastCodeBtn.classList.remove("hidden");

                if (this.state.countdownInterval) clearInterval(this.state.countdownInterval);

                const lastSpinTimestamp = parseInt(localStorage.getItem(this.config.localStorageKeys.LAST_SPIN));
                const cooldownTime = this.config.COOLDOWN_HOURS * 3600 * 1000;

                this.state.countdownInterval = setInterval(() => {
                    const remainingTime = cooldownTime - (Date.now() - lastSpinTimestamp);
                    if (remainingTime <= 0) {
                        clearInterval(this.state.countdownInterval);
                        localStorage.removeItem(this.config.localStorageKeys.LAST_SPIN);
                        localStorage.removeItem(this.config.localStorageKeys.LAST_WIN);
                        this.updateUIState();
                    } else {
                        const h = Math.floor(remainingTime / 3600000);
                        const m = Math.floor((remainingTime % 3600000) / 60000);
                        const s = Math.floor((remainingTime % 60000) / 1000);
                        this.elements.spinBtn.style.fontSize = "0.6rem";
                        this.elements.spinBtn.innerHTML = `C√≤n l·∫°i<br>${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
                    }
                }, 1000);
            },

            canSpin() {
                if (this.utils.getExtraSpins() > 0) return true;
                const lastSpin = localStorage.getItem(this.config.localStorageKeys.LAST_SPIN);
                if (!lastSpin) return true;
                const cooldownMs = this.config.COOLDOWN_HOURS * 3600 * 1000;
                return (Date.now() - parseInt(lastSpin)) >= cooldownMs;
            },
            
            checkPassword() {
                const password = this.elements.passwordInput.value.trim();
                if (password === this.config.SECRET_PASSWORD) {
                    const currentExtraSpins = this.utils.getExtraSpins();
                    this.utils.setExtraSpins(currentExtraSpins + 1);
                    this.toggleModal(this.elements.passwordModal, false);
                    this.updateUIState();
                    alert('üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c 1 l∆∞·ª£t quay th√™m!');
                } else {
                    alert('‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng. Vui l√≤ng th·ª≠ l·∫°i!');
                    this.elements.passwordInput.value = '';
                    this.elements.passwordInput.focus();
                }
            },

            // --- MODALS ---
            toggleModal(modalElement, show) {
                if (show) {
                    modalElement.classList.add("show");
                    if(modalElement.id === 'password-modal') {
                        this.elements.passwordInput.value = '';
                        this.elements.passwordInput.focus();
                    }
                } else {
                    modalElement.classList.remove("show");
                }
            },

            showResultModal(prize, promoCode) {
                this.elements.prizeResultEl.textContent = prize.fullName; 
                this.elements.promoCodeEl.textContent = promoCode;
                let conditionText = '';
                if (prize.type === 'v70' || prize.type === 'v60') {
                    conditionText = '√Åp d·ª•ng v·ªõi m·ªôt s·ªë s·∫£n ph·∫©m nh·∫•t ƒë·ªãnh. Li√™n h·ªá Zalo ƒë·ªÉ mua h√†ng.';
                } else if (prize.type.includes('combo')) {
                    conditionText = 'Li√™n h·ªá nh√¢n vi√™n ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n chi ti·∫øt v·ªÅ combo.';
                }
                this.elements.prizeConditionEl.textContent = conditionText;
                this.toggleModal(this.elements.resultModal, true);
            },

            showLastWin() {
                const lastWinData = localStorage.getItem(this.config.localStorageKeys.LAST_WIN);
                if (lastWinData) {
                    const { prizeName, promoCode, prizeType } = JSON.parse(lastWinData);
                    const pseudoPrize = { fullName: prizeName, type: prizeType || '' };
                    this.showResultModal(pseudoPrize, promoCode);
                }
            },
            
            // --- PARTICLE EFFECT ---
            createParticles() {
                for (let i = 0; i < 30; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.animationDelay = `${Math.random() * 25}s`;
                    particle.style.animationDuration = `${Math.random() * 15 + 15}s`;
                    this.elements.particlesContainer.appendChild(particle);
                }
            },

            // --- UTILITY FUNCTIONS ---
            utils: {
                getExtraSpins() {
                    return parseInt(localStorage.getItem(app.config.localStorageKeys.EXTRA_SPINS) || '0');
                },
                setExtraSpins(count) {
                    localStorage.setItem(app.config.localStorageKeys.EXTRA_SPINS, count.toString());
                },
                generatePromoCode(length = 8) {
                    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                    let result = Array.from({ length }, () => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
                    return `${result.slice(0, 4)}-${result.slice(4)}`;
                },
                getUrlParams() {
                    const urlParams = new URLSearchParams(window.location.search);
                    return {
                        userId: urlParams.get('user_id'),
                        phone: urlParams.get('phone'),
                        displayName: urlParams.get('display_name'),
                        name: urlParams.get('name')
                    };
                },
                async sendDataToWebhook(data) {
                    try {
                        const response = await fetch(app.config.WEBHOOK_URL, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(data)
                        });
                        console.log(response.ok ? "Webhook sent successfully!" : `Webhook failed: ${response.statusText}`);
                    } catch (error) {
                        console.error("Error sending webhook:", error);
                    }
                },
                adjustColor(hex, percent) {
                    let r = parseInt(hex.slice(1, 3), 16),
                        g = parseInt(hex.slice(3, 5), 16),
                        b = parseInt(hex.slice(5, 7), 16);
                    const t = percent < 0 ? 0 : 255;
                    const p = Math.abs(percent) / 100;
                    r = Math.round((t - r) * p) + r;
                    g = Math.round((t - g) * p) + g;
                    b = Math.round((t - b) * p) + b;
                    return `#${(r * 65536 + g * 256 + b).toString(16).padStart(6, '0')}`;
                }
            }
        };

        // Run the application
        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
